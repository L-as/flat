<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances ,StandaloneDeriving #-}</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- | Flat instances for the base library</span><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Flat.Instances.Base</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bool</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Fixed</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Flat.Instances.Util.html"><span class="hs-identifier">Flat.Instances.Util</span></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Complex</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Complex</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ratio</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-cpp">#if MIN_VERSION_base(4,9,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-17"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-19"></a><span class="hs-cpp">#if !MIN_VERSION_base(4,9,0)
</span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Generic</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Complex</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- $setup</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- &gt;&gt;&gt; :set -XNegativeLiterals</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- &gt;&gt;&gt; import Flat.Instances.Test</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Fixed</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Int</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Complex(Complex(..))</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- &gt;&gt;&gt; import Numeric.Natural</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Word</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Ratio</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.List.NonEmpty as B</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- &gt;&gt;&gt; let test = tstBits</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">{- |
`()`, as all data types with a single constructor, has a zero-length encoding.

&gt;&gt;&gt; test ()
(True,0,&quot;&quot;)
-}</span><span>
</span><a name="line-41"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-42"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">{-|
One bit is plenty for a Bool.

&gt;&gt;&gt; test False
(True,1,&quot;0&quot;)

&gt;&gt;&gt; test True
(True,1,&quot;1&quot;)
-}</span><span>
</span><a name="line-57"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-58"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eBool"><span class="hs-identifier hs-var">eBool</span></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sBool"><span class="hs-identifier hs-var">sBool</span></a><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Prim.html#dBool"><span class="hs-identifier hs-var">dBool</span></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">{-|
Char's are mapped to Word32 and then encoded.

For ascii characters, the encoding is standard ascii. 

&gt;&gt;&gt; test 'a'
(True,8,&quot;01100001&quot;)

For unicode characters, the encoding is non standard.

&gt;&gt;&gt; test '&#200;'
(True,16,&quot;11001000 00000001&quot;)

&gt;&gt;&gt; test '&#19981;'
(True,24,&quot;10001101 10011100 00000001&quot;)

#ifndef ETA
&gt;&gt;&gt; test &quot;\x1F600&quot;
(True,26,&quot;11000000 01110110 00000011 10&quot;)
#endif
-}</span><span>
</span><a name="line-85"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-86"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sChar"><span class="hs-identifier hs-var">sChar</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eChar"><span class="hs-identifier hs-var">eChar</span></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dChar"><span class="hs-identifier hs-var">dChar</span></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">{- |
&gt;&gt;&gt; test (Nothing::Maybe Bool)
(True,1,&quot;0&quot;)

&gt;&gt;&gt; test (Just False::Maybe Bool)
(True,2,&quot;10&quot;)
-}</span><span>
</span><a name="line-99"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094424"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679094424"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">{-|
&gt;&gt;&gt; test (Left False::Either Bool ())
(True,2,&quot;00&quot;)

&gt;&gt;&gt; test (Right ()::Either Bool ())
(True,1,&quot;1&quot;)
-}</span><span>
</span><a name="line-108"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094422"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094423"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679094422"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679094423"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">{-|
&gt;&gt;&gt; test (MkFixed 123 :: Fixed E0)
(True,16,&quot;11110110 00000001&quot;)

&gt;&gt;&gt; test (MkFixed 123 :: Fixed E0) == test (MkFixed 123 :: Fixed E2)
True
-}</span><span>
</span><a name="line-117"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fixed</span><span> </span><a href="#local-6989586621679094419"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MkFixed</span><span> </span><a name="local-6989586621679094420"><a href="#local-6989586621679094420"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Class.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679094420"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MkFixed</span><span> </span><a name="local-6989586621679094421"><a href="#local-6989586621679094421"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Class.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679094421"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MkFixed</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">{- |
Word8 always take 8 bits.

&gt;&gt;&gt; test (0::Word8)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (255::Word8)
(True,8,&quot;11111111&quot;)
-}</span><span>
</span><a name="line-133"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-134"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eWord8"><span class="hs-identifier hs-var">eWord8</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Prim.html#dWord8"><span class="hs-identifier hs-var">dWord8</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sWord8"><span class="hs-identifier hs-var">sWord8</span></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">{- |
Natural, Word, Word16, Word32 and Word64 are encoded as a non empty list of 7 bits chunks (least significant chunk first and most significant bit first in every chunk).

Words are always encoded in a whole number of bytes, as every chunk is 8 bits long (1 bit for the List constructor, plus 7 bits for the value).

The actual definition is:

@
Word64 &#8801;   Word64 Word

Word32 &#8801;   Word32 Word

Word16 &#8801;   Word16 Word

Word &#8801;   Word (LeastSignificantFirst (NonEmptyList (MostSignificantFirst Word7)))

LeastSignificantFirst a &#8801;   LeastSignificantFirst a

NonEmptyList a &#8801;   Elem a
                 | Cons a (NonEmptyList a)

MostSignificantFirst a &#8801;   MostSignificantFirst a

Word7 &#8801;   V0
        | V1
        | V2
        ...
        | V127
@

Values between as 0 and 127 fit in a single byte. 

127 (0b1111111) is represented as Elem V127 and encoded as: Elem=0 127=1111111

&gt;&gt;&gt; test (127::Word) 
(True,8,&quot;01111111&quot;)

254 (0b11111110) is represented as Cons V126 (Elem V1) (254=128+126) and encoded as: Cons=1 V126=1111110 (Elem=0 V1=0000001):

&gt;&gt;&gt; test (254::Word)
(True,16,&quot;11111110 00000001&quot;)

Another example, 32768 (Ob1000000000000000 = 0000010 0000000 0000000):

&gt;&gt;&gt; test (32768::Word32)
(True,24,&quot;10000000 10000000 00000010&quot;)

As this is a variable length encoding, values are encoded in the same way, whatever their type:

&gt;&gt;&gt; all (test (3::Word) ==) [test (3::Word16),test (3::Word32),test (3::Word64)]
True
-}</span><span>
</span><a name="line-192"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-193"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sWord"><span class="hs-identifier hs-var">sWord</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eWord"><span class="hs-identifier hs-var">eWord</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dWord"><span class="hs-identifier hs-var">dWord</span></a><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-comment">{- |
Naturals are encoded just as the fixed size Words. 

&gt;&gt;&gt; test (0::Natural)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (2^120::Natural)
(True,144,&quot;10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 00000010&quot;)
-}</span><span>
</span><a name="line-208"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Natural</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-209"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sNatural"><span class="hs-identifier hs-var">sNatural</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eNatural"><span class="hs-identifier hs-var">eNatural</span></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dNatural"><span class="hs-identifier hs-var">dNatural</span></a><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Word16</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-217"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eWord16"><span class="hs-identifier hs-var">eWord16</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dWord16"><span class="hs-identifier hs-var">dWord16</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sWord16"><span class="hs-identifier hs-var">sWord16</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-224"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eWord32"><span class="hs-identifier hs-var">eWord32</span></a><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dWord32"><span class="hs-identifier hs-var">dWord32</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sWord32"><span class="hs-identifier hs-var">sWord32</span></a><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-231"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eWord64"><span class="hs-identifier hs-var">eWord64</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dWord64"><span class="hs-identifier hs-var">dWord64</span></a><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sWord64"><span class="hs-identifier hs-var">sWord64</span></a><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">{- |
Integer, Int, Int16, Int32 and Int64 are defined as the &lt;https://developers.google.com/protocol-buffers/docs/encoding#signed-integers ZigZag&gt; encoded version of the equivalent unsigned Word:

@
Int   &#8801;  Int   (ZigZag Word)

Int64 &#8801;  Int64 (ZigZag Word64)

Int32 &#8801;  Int32 (ZigZag Word32)

Int16 &#8801;  Int16 (ZigZag Word16)

Int8  &#8801;  Int8  (ZigZag Word8)

ZigZag a &#8801; ZigZag a
@

ZigZag encoding alternates between positive and negative numbers, so that numbers whose absolute value is small can be encoded efficiently:

&gt;&gt;&gt; test (0::Int)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (-1::Int)
(True,8,&quot;00000001&quot;)

&gt;&gt;&gt; test (1::Int)
(True,8,&quot;00000010&quot;)

&gt;&gt;&gt; test (-2::Int)
(True,8,&quot;00000011&quot;)

&gt;&gt;&gt; test (2::Int)
(True,8,&quot;00000100&quot;)
-}</span><span>
</span><a name="line-272"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-273"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sInt"><span class="hs-identifier hs-var">sInt</span></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eInt"><span class="hs-identifier hs-var">eInt</span></a><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dInt"><span class="hs-identifier hs-var">dInt</span></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">{- |
Integers are encoded just as the fixed size Ints. 

&gt;&gt;&gt; test (0::Integer)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (-1::Integer)
(True,8,&quot;00000001&quot;)

&gt;&gt;&gt; test (1::Integer)
(True,8,&quot;00000010&quot;)

&gt;&gt;&gt; test (-(2^4)::Integer)
(True,8,&quot;00011111&quot;)

&gt;&gt;&gt; test (2^4::Integer)
(True,8,&quot;00100000&quot;)

&gt;&gt;&gt; test (-(2^120)::Integer)
(True,144,&quot;11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 00000011&quot;)

&gt;&gt;&gt; test (2^120::Integer)
(True,144,&quot;10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 10000000 00000100&quot;)
-}</span><span>
</span><a name="line-303"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-304"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sInteger"><span class="hs-identifier hs-var">sInteger</span></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eInteger"><span class="hs-identifier hs-var">eInteger</span></a><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dInteger"><span class="hs-identifier hs-var">dInteger</span></a><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span class="hs-comment">{-|
&gt;&gt;&gt; test (0::Int8)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (127::Int8)
(True,8,&quot;11111110&quot;)

&gt;&gt;&gt; test (-128::Int8)
(True,8,&quot;11111111&quot;)
-}</span><span>
</span><a name="line-320"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Int8</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-321"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eInt8"><span class="hs-identifier hs-var">eInt8</span></a><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dInt8"><span class="hs-identifier hs-var">dInt8</span></a><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sInt8"><span class="hs-identifier hs-var">sInt8</span></a><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span class="hs-comment">{- |
&gt;&gt;&gt; test (0::Int16)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (1::Int16)
(True,8,&quot;00000010&quot;)

&gt;&gt;&gt; test (-1::Int16)
(True,8,&quot;00000001&quot;)

&gt;&gt;&gt; test (minBound::Int16)
(True,24,&quot;11111111 11111111 00000011&quot;)

equivalent to 0b1111111111111111

&gt;&gt;&gt; test (maxBound::Int16)
(True,24,&quot;11111110 11111111 00000011&quot;)

equivalent to 0b1111111111111110
-}</span><span>
</span><a name="line-347"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Int16</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-348"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sInt16"><span class="hs-identifier hs-var">sInt16</span></a><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eInt16"><span class="hs-identifier hs-var">eInt16</span></a><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dInt16"><span class="hs-identifier hs-var">dInt16</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">{- |
&gt;&gt;&gt; test (0::Int32)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (minBound::Int32)
(True,40,&quot;11111111 11111111 11111111 11111111 00001111&quot;)

&gt;&gt;&gt; test (maxBound::Int32)
(True,40,&quot;11111110 11111111 11111111 11111111 00001111&quot;)
-}</span><span>
</span><a name="line-364"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Int32</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-365"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sInt32"><span class="hs-identifier hs-var">sInt32</span></a><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eInt32"><span class="hs-identifier hs-var">eInt32</span></a><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dInt32"><span class="hs-identifier hs-var">dInt32</span></a><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">{- |
&gt;&gt;&gt; test (0::Int64)
(True,8,&quot;00000000&quot;)

&gt;&gt;&gt; test (minBound::Int64)
(True,80,&quot;11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 00000001&quot;)

&gt;&gt;&gt; test (maxBound::Int64)
(True,80,&quot;11111110 11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111 00000001&quot;)
-}</span><span>
</span><a name="line-381"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Int64</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-382"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sInt64"><span class="hs-identifier hs-var">sInt64</span></a><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eInt64"><span class="hs-identifier hs-var">eInt64</span></a><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Strict.html#dInt64"><span class="hs-identifier hs-var">dInt64</span></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-comment">{- |
Floats are encoded as standard IEEE binary32 values:

@
IEEE_754_binary32 &#8801; IEEE_754_binary32 {sign :: Sign,
                                        exponent :: MostSignificantFirst Bits8,
                                        fraction :: MostSignificantFirst Bits23}
@

&gt;&gt;&gt; test (0::Float)
(True,32,&quot;00000000 00000000 00000000 00000000&quot;)

&gt;&gt;&gt; test (1.4012984643E-45::Float)
(True,32,&quot;00000000 00000000 00000000 00000001&quot;)

&gt;&gt;&gt; test (1.1754942107E-38::Float)
(True,32,&quot;00000000 01111111 11111111 11111111&quot;)
-}</span><span>
</span><a name="line-407"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-408"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sFloat"><span class="hs-identifier hs-var">sFloat</span></a><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eFloat"><span class="hs-identifier hs-var">eFloat</span></a><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Prim.html#dFloat"><span class="hs-identifier hs-var">dFloat</span></a><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-comment">{- |
Doubles are encoded as standard IEEE binary64 values:

@
IEEE_754_binary64 &#8801; IEEE_754_binary64 {sign :: Sign,
                                        exponent :: MostSignificantFirst Bits11,
                                        fraction :: MostSignificantFirst Bits52}
@
-}</span><span>
</span><a name="line-423"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-424"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#sDouble"><span class="hs-identifier hs-var">sDouble</span></a><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#eDouble"><span class="hs-identifier hs-var">eDouble</span></a><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Decoder.Prim.html#dDouble"><span class="hs-identifier hs-var">dDouble</span></a><span>
</span><a name="line-429"></a><span>
</span><a name="line-430"></a><span class="hs-comment">{-|
&gt;&gt;&gt; test (4 :+ 2 :: Complex Word8)
(True,16,&quot;00000100 00000010&quot;)
-}</span><span>
</span><a name="line-434"></a><span class="hs-keyword">instance</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094418"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Complex</span><span> </span><a href="#local-6989586621679094418"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span class="hs-comment">{-|
Ratios are encoded as tuples of (numerator,denominator)

&gt;&gt;&gt; test (3%4::Ratio Word8)
(True,16,&quot;00000011 00000100&quot;)
-}</span><span>
</span><a name="line-442"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621679094415"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094415"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ratio</span><span> </span><a href="#local-6989586621679094415"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-443"></a><span>    </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><a name="local-6989586621679094416"><a href="#local-6989586621679094416"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Class.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">numerator</span><span> </span><a href="#local-6989586621679094416"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">denominator</span><span> </span><a href="#local-6989586621679094416"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span>    </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><a name="local-6989586621679094417"><a href="#local-6989586621679094417"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Class.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">numerator</span><span> </span><a href="#local-6989586621679094417"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">denominator</span><span> </span><a href="#local-6989586621679094417"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span>    </span><span class="hs-comment">-- decode = uncurry (%) &lt;$&gt; decode</span><span>
</span><a name="line-448"></a><span>    </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%</span><span class="hs-special">)</span><span> </span><a href="Flat.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a><span> </span><a href="Flat.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span class="hs-comment">{-|
&gt;&gt;&gt; test ([]::[Bool])
(True,1,&quot;0&quot;)

&gt;&gt;&gt; test [False,False]
(True,5,&quot;10100&quot;)
-}</span><span>
</span><a name="line-457"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094414"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679094414"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-comment">-- Generic list instance (stack overflows with ETA, see https://github.com/typelead/eta/issues/901)</span><span>
</span><a name="line-460"></a><span class="hs-comment">-- where</span><span>
</span><a name="line-461"></a><span class="hs-comment">--size [] n = n+1</span><span>
</span><a name="line-462"></a><span class="hs-comment">--size (h:t) n = trampoline size t (trampoline size h (n+1))</span><span>
</span><a name="line-463"></a><span class="hs-comment">-- size = sizeListWith size -- foldl' (\n e -&gt; ) n</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- encode = error &quot;BAD&quot;</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- encode = trampoline . encodeListWith encode</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- decode = decodeListWith decode</span><span>
</span><a name="line-467"></a><span class="hs-comment">-- sizeListWith siz l n = foldl' (\n e -&gt; 1 + n + siz e 0) n l</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- #ifdef ETA_VERSION</span><span>
</span><a name="line-469"></a><span class="hs-comment">-- import Data.Function(trampoline)</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- import GHC.IO(trampolineIO)</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- #else</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- trampoline = id</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- trampolineIO = id</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- #endif</span><span>
</span><a name="line-475"></a><span>
</span><a name="line-476"></a><span class="hs-comment">{- |
For better encoding/decoding performance, it is useful to declare instances of concrete list types, such as [Char].

&gt;&gt;&gt; test &quot;&quot;
(True,1,&quot;0&quot;)

&gt;&gt;&gt; test &quot;aaa&quot;
(True,28,&quot;10110000 11011000 01101100 0010&quot;)
-}</span><span>
</span><a name="line-485"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPING</span><span> </span><span class="hs-pragma">#-}</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-cpp">#if MIN_VERSION_base(4,9,0)
</span><span class="hs-comment">{-|
&gt;&gt;&gt; test (B.fromList [True])
(True,2,&quot;10&quot;)

&gt;&gt;&gt; test (B.fromList [False,False])
(True,4,&quot;0100&quot;)
-}</span><span>
</span><a name="line-496"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094413"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B.NonEmpty</span><span> </span><a href="#local-6989586621679094413"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-497"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-499"></a><span class="hs-comment">{- |
Tuples are supported up to 7 elements.

&gt;&gt;&gt; test (False,())
(True,1,&quot;0&quot;)

&gt;&gt;&gt; test ((),())
(True,0,&quot;&quot;)

&quot;7 elements tuples ought to be enough for anybody&quot; (Bill Gates - apocryphal)

&gt;&gt;&gt; test (False,True,True,True,False,True,True)
(True,7,&quot;0111011&quot;)

tst (1::Int,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;)
...error
-}</span><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span class="hs-comment">-- Not sure if these should be OVERLAPPABLE</span><span>
</span><a name="line-518"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-special">(</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094411"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094412"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679094411"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094412"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-special">(</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094408"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094409"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094410"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679094408"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094409"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094410"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-special">(</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094404"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094405"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094406"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094407"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679094404"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094405"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094406"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094407"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-special">(</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094399"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094400"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094401"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094402"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094403"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679094399"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094400"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094401"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094402"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094403"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-special">(</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094393"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094394"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094395"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094396"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094397"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094398"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679094393"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094394"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094395"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094396"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094397"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094398"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-special">(</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094386"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-532"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094387"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-533"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094388"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-534"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094389"><span class="hs-identifier hs-type">d</span></a><span>
</span><a name="line-535"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094390"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-536"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094391"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-537"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><a href="#local-6989586621679094392"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-538"></a><span>                             </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679094386"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094387"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094388"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094389"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094390"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094391"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679094392"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a></pre></body></html>