<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances,UndecidableInstances ,NoMonomorphismRestriction #-}</span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Flat.Instances.Mono</span><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Flat.Instances.Mono.html#sizeSequence"><span class="hs-identifier hs-var">sizeSequence</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#encodeSequence"><span class="hs-identifier hs-var">encodeSequence</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#decodeSequence"><span class="hs-identifier hs-var">decodeSequence</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#sizeList"><span class="hs-identifier hs-var">sizeList</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#encodeList"><span class="hs-identifier hs-var">encodeList</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#decodeList"><span class="hs-identifier hs-var">decodeList</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#sizeSet"><span class="hs-identifier hs-var">sizeSet</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#encodeSet"><span class="hs-identifier hs-var">encodeSet</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#decodeSet"><span class="hs-identifier hs-var">decodeSet</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#sizeMap"><span class="hs-identifier hs-var">sizeMap</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#encodeMap"><span class="hs-identifier hs-var">encodeMap</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#decodeMap"><span class="hs-identifier hs-var">decodeMap</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#AsArray"><span class="hs-identifier hs-type">AsArray</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#AsList"><span class="hs-identifier hs-type">AsList</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#AsSet"><span class="hs-identifier hs-type">AsSet</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Flat.Instances.Mono.html#AsMap"><span class="hs-identifier hs-type">AsMap</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">where</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.MonoTraversable</span><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Element</span><span>
</span><a name="line-24"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ofoldl'</span><span>
</span><a name="line-25"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">otoList</span><span>
</span><a name="line-26"></a><span>                                                </span><span class="hs-comment">--, olength</span><span>
</span><a name="line-27"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonoFoldable</span><span>
</span><a name="line-28"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Sequences</span><span>                 </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">IsSequence</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Sequences</span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Containers</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- ( ContainerKey</span><span>
</span><a name="line-33"></a><span class="hs-comment">--                                                 , IsMap</span><span>
</span><a name="line-34"></a><span class="hs-comment">--                                                 , MapValue</span><span>
</span><a name="line-35"></a><span class="hs-comment">--                                                 , mapFromList</span><span>
</span><a name="line-36"></a><span class="hs-comment">--                                                 , mapToList</span><span>
</span><a name="line-37"></a><span class="hs-comment">--                                                 , IsSet</span><span>
</span><a name="line-38"></a><span class="hs-comment">--                                                 , setToList</span><span>
</span><a name="line-39"></a><span class="hs-comment">--                                                 , setFromList</span><span>
</span><a name="line-40"></a><span class="hs-comment">--                                                 )</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><a href="Flat.Instances.Util.html"><span class="hs-identifier">Flat.Instances.Util</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Foldable</span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">-- $setup</span><span>
</span><a name="line-45"></a><span class="hs-comment">-- &gt;&gt;&gt; import Flat.Instances.Base()</span><span>
</span><a name="line-46"></a><span class="hs-comment">-- &gt;&gt;&gt; import Flat.Instances.Test</span><span>
</span><a name="line-47"></a><span class="hs-comment">-- &gt;&gt;&gt; import Data.Word    </span><span>
</span><a name="line-48"></a><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.Set</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.Map</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">{-|
Sequences are defined as Arrays:

Array v = A0
        | A1 v (Array v)
        | A2 v v (Array v)
        ...
        | A255 ... (Array v)

In practice, this means that the sequence is encoded as a sequence of blocks of up to 255 elements, with every block preceded by the count of the elements in the block and a final 0-length block.

Lists are defined as:

List a &#8801;  Nil
        | Cons a (List a)

The AsList/AsArray wrappers can be used to serialise sequences as Lists or Arrays

&gt;&gt;&gt; tst $ AsArray ([]::[()])
(True,8,[0])

&gt;&gt;&gt; tst $ AsArray [11::Word8,22,33]
(True,40,[3,11,22,33,0])

&gt;&gt;&gt; tst $ AsList ([]::[()])
(True,1,[0])

&gt;&gt;&gt; tst (AsList [11::Word8,22,33])
(True,28,[133,197,164,32])

&gt;&gt;&gt; tst (AsSet (Data.Set.fromList [11::Word8,22,33]))
(True,28,[133,197,164,32])

-}</span><span>
</span><a name="line-85"></a><span class="hs-keyword">newtype</span><span> </span><a name="AsArray"><a href="Flat.Instances.Mono.html#AsArray"><span class="hs-identifier">AsArray</span></a></a><span> </span><a name="local-6989586621679085098"><a href="#local-6989586621679085098"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-86"></a><span>  </span><a name="AsArray"><a href="Flat.Instances.Mono.html#AsArray"><span class="hs-identifier">AsArray</span></a></a><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unArray"><a href="Flat.Instances.Mono.html#unArray"><span class="hs-identifier">unArray</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679085098"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSequence</span><span> </span><a href="#local-6989586621679085102"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085102"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><a href="Flat.Instances.Mono.html#AsArray"><span class="hs-identifier hs-type">AsArray</span></a><span> </span><a href="#local-6989586621679085102"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-91"></a><span>  </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-special">(</span><a href="Flat.Instances.Mono.html#AsArray"><span class="hs-identifier hs-var">AsArray</span></a><span> </span><a name="local-6989586621679085103"><a href="#local-6989586621679085103"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#sizeSequence"><span class="hs-identifier hs-var">sizeSequence</span></a><span> </span><a href="#local-6989586621679085103"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-92"></a><span>  </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-special">(</span><a href="Flat.Instances.Mono.html#AsArray"><span class="hs-identifier hs-var">AsArray</span></a><span> </span><a name="local-6989586621679085104"><a href="#local-6989586621679085104"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#encodeSequence"><span class="hs-identifier hs-var">encodeSequence</span></a><span> </span><a href="#local-6989586621679085104"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-93"></a><span>  </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#AsArray"><span class="hs-identifier hs-var">AsArray</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Instances.Mono.html#decodeSequence"><span class="hs-identifier hs-var">decodeSequence</span></a><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- |Calculate size of an instance of IsSequence as the sum:</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- * of the size of all the elements</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- * plus the size of the array constructors (1 byte every 255 elements plus one final byte)</span><span>
</span><a name="line-98"></a><span class="hs-identifier">sizeSequence</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSequence</span><span> </span><a href="#local-6989586621679085116"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085116"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679085116"><span class="hs-identifier hs-type">mono</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Types.html#NumBits"><span class="hs-identifier hs-type">NumBits</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Types.html#NumBits"><span class="hs-identifier hs-type">NumBits</span></a><span>
</span><a name="line-100"></a><a name="sizeSequence"><a href="Flat.Instances.Mono.html#sizeSequence"><span class="hs-identifier">sizeSequence</span></a></a><span> </span><a name="local-6989586621679085117"><a href="#local-6989586621679085117"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679085118"><a href="#local-6989586621679085118"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679085119"><a href="#local-6989586621679085119"><span class="hs-identifier">sz</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679085120"><a href="#local-6989586621679085120"><span class="hs-identifier">len</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-102"></a><span>          </span><span class="hs-identifier hs-var">ofoldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679085121"><a href="#local-6989586621679085121"><span class="hs-identifier">acc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679085122"><a href="#local-6989586621679085122"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679085123"><a href="#local-6989586621679085123"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679085123"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679085121"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679085122"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679085118"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Flat.Types.html#NumBits"><span class="hs-identifier hs-type">NumBits</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679085117"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><a href="#local-6989586621679085119"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="Flat.Encoder.Size.html#arrayBits"><span class="hs-identifier hs-var">arrayBits</span></a><span> </span><a href="#local-6989586621679085120"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-104"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">sizeSequence</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- TODO: check which one is faster</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- sizeSequence s acc = ofoldl' (flip size) acc s + arrayBits (olength s)</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-- |Encode an instance of IsSequence, as an array</span><span>
</span><a name="line-110"></a><span class="hs-identifier">encodeSequence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085115"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonoFoldable</span><span> </span><a href="#local-6989586621679085115"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679085115"><span class="hs-identifier hs-type">mono</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Encoder.Strict.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a><span>
</span><a name="line-111"></a><a name="encodeSequence"><a href="Flat.Instances.Mono.html#encodeSequence"><span class="hs-identifier">encodeSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Util.html#encodeArray"><span class="hs-identifier hs-var">encodeArray</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">otoList</span><span>
</span><a name="line-112"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">encodeSequence</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- |Decode an instance of IsSequence, as an array</span><span>
</span><a name="line-115"></a><span class="hs-identifier">decodeSequence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085114"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IsSequence</span><span> </span><a href="#local-6989586621679085114"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Decoder.Types.html#Get"><span class="hs-identifier hs-type">Get</span></a><span> </span><a href="#local-6989586621679085114"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-116"></a><a name="decodeSequence"><a href="Flat.Instances.Mono.html#decodeSequence"><span class="hs-identifier">decodeSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.fromList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Decoder.Strict.html#decodeArrayWith"><span class="hs-identifier hs-var">decodeArrayWith</span></a><span> </span><a href="Flat.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a><span>
</span><a name="line-117"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">decodeSequence</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-keyword">newtype</span><span> </span><a name="AsList"><a href="Flat.Instances.Mono.html#AsList"><span class="hs-identifier">AsList</span></a></a><span> </span><a name="local-6989586621679085097"><a href="#local-6989586621679085097"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-120"></a><span>  </span><a name="AsList"><a href="Flat.Instances.Mono.html#AsList"><span class="hs-identifier">AsList</span></a></a><span>
</span><a name="line-121"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unList"><a href="Flat.Instances.Mono.html#unList"><span class="hs-identifier">unList</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679085097"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSequence</span><span> </span><a href="#local-6989586621679085101"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085101"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><a href="Flat.Instances.Mono.html#AsList"><span class="hs-identifier hs-type">AsList</span></a><span> </span><a href="#local-6989586621679085101"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-125"></a><span>  </span><span class="hs-comment">-- size   = sizeList . S.unpack . unList</span><span>
</span><a name="line-126"></a><span>  </span><span class="hs-comment">-- encode = encodeList . S.unpack . unList</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-comment">-- decode = AsList . S.fromList &lt;$&gt; decodeListotoList</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span>  </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#sizeList"><span class="hs-identifier hs-var">sizeList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unList</span><span>
</span><a name="line-130"></a><span>  </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#encodeList"><span class="hs-identifier hs-var">encodeList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unList</span><span>
</span><a name="line-131"></a><span>  </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#AsList"><span class="hs-identifier hs-var">AsList</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Instances.Mono.html#decodeList"><span class="hs-identifier hs-var">decodeList</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">sizeList</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-134"></a><span class="hs-identifier">sizeList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonoFoldable</span><span> </span><a href="#local-6989586621679085113"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085113"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679085113"><span class="hs-identifier hs-type">mono</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Types.html#NumBits"><span class="hs-identifier hs-type">NumBits</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Types.html#NumBits"><span class="hs-identifier hs-type">NumBits</span></a><span>
</span><a name="line-135"></a><a name="sizeList"><a href="Flat.Instances.Mono.html#sizeList"><span class="hs-identifier">sizeList</span></a></a><span> </span><a name="local-6989586621679085124"><a href="#local-6989586621679085124"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679085125"><a href="#local-6989586621679085125"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679085126"><a href="#local-6989586621679085126"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679085127"><a href="#local-6989586621679085127"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Class.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679085127"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679085126"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679085125"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679085124"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">encodeList</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-138"></a><span class="hs-identifier">encodeList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085112"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonoFoldable</span><span> </span><a href="#local-6989586621679085112"><span class="hs-identifier hs-type">mono</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679085112"><span class="hs-identifier hs-type">mono</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Encoder.Strict.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a><span>
</span><a name="line-139"></a><a name="encodeList"><a href="Flat.Instances.Mono.html#encodeList"><span class="hs-identifier">encodeList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#encodeListWith"><span class="hs-identifier hs-var">encodeListWith</span></a><span> </span><a href="Flat.Class.html#encode"><span class="hs-identifier hs-var">encode</span></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">otoList</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">decodeList</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-142"></a><span class="hs-identifier">decodeList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSequence</span><span> </span><a href="#local-6989586621679085111"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085111"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Decoder.Types.html#Get"><span class="hs-identifier hs-type">Get</span></a><span> </span><a href="#local-6989586621679085111"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-143"></a><a name="decodeList"><a href="Flat.Instances.Mono.html#decodeList"><span class="hs-identifier">decodeList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.fromList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Decoder.Strict.html#decodeListWith"><span class="hs-identifier hs-var">decodeListWith</span></a><span> </span><a href="Flat.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-keyword">newtype</span><span> </span><a name="AsSet"><a href="Flat.Instances.Mono.html#AsSet"><span class="hs-identifier">AsSet</span></a></a><span> </span><a name="local-6989586621679085096"><a href="#local-6989586621679085096"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-146"></a><span>  </span><a name="AsSet"><a href="Flat.Instances.Mono.html#AsSet"><span class="hs-identifier">AsSet</span></a></a><span>
</span><a name="line-147"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unSet"><a href="Flat.Instances.Mono.html#unSet"><span class="hs-identifier">unSet</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679085096"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-148"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSet</span><span> </span><a href="#local-6989586621679085100"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085100"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><a href="Flat.Instances.Mono.html#AsSet"><span class="hs-identifier hs-type">AsSet</span></a><span> </span><a href="#local-6989586621679085100"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-151"></a><span>  </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#sizeSet"><span class="hs-identifier hs-var">sizeSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unSet</span><span>
</span><a name="line-152"></a><span>  </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#encodeSet"><span class="hs-identifier hs-var">encodeSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unSet</span><span>
</span><a name="line-153"></a><span>  </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#AsSet"><span class="hs-identifier hs-var">AsSet</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Instances.Mono.html#decodeSet"><span class="hs-identifier hs-var">decodeSet</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-identifier">sizeSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSet</span><span> </span><a href="#local-6989586621679085110"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085110"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Encoder.Types.html#Size"><span class="hs-identifier hs-type">Size</span></a><span> </span><a href="#local-6989586621679085110"><span class="hs-identifier hs-type">set</span></a><span>
</span><a name="line-156"></a><a name="sizeSet"><a href="Flat.Instances.Mono.html#sizeSet"><span class="hs-identifier">sizeSet</span></a></a><span> </span><a name="local-6989586621679085128"><a href="#local-6989586621679085128"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679085129"><a href="#local-6989586621679085129"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679085130"><a href="#local-6989586621679085130"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679085131"><a href="#local-6989586621679085131"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Class.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679085131"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679085130"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679085129"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679085128"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-157"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">sizeSet</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-identifier">encodeSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSet</span><span> </span><a href="#local-6989586621679085109"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085109"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679085109"><span class="hs-identifier hs-type">set</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Encoder.Strict.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a><span>
</span><a name="line-160"></a><a name="encodeSet"><a href="Flat.Instances.Mono.html#encodeSet"><span class="hs-identifier">encodeSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#encodeList"><span class="hs-identifier hs-var">encodeList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">setToList</span><span>
</span><a name="line-161"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">encodeSet</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-identifier">decodeSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsSet</span><span> </span><a href="#local-6989586621679085108"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679085108"><span class="hs-identifier hs-type">set</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Decoder.Types.html#Get"><span class="hs-identifier hs-type">Get</span></a><span> </span><a href="#local-6989586621679085108"><span class="hs-identifier hs-type">set</span></a><span>
</span><a name="line-164"></a><a name="decodeSet"><a href="Flat.Instances.Mono.html#decodeSet"><span class="hs-identifier">decodeSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">setFromList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Instances.Mono.html#decodeList"><span class="hs-identifier hs-var">decodeList</span></a><span>
</span><a name="line-165"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">decodeSet</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">{-|
Maps are saved as lists of (key,value) tuples.

&gt;&gt;&gt; tst (AsMap (Data.Map.fromList ([]::[(Word8,())])))
(True,1,[0])

&gt;&gt;&gt; tst (AsMap (Data.Map.fromList [(3::Word,9::Word)]))
(True,18,[129,132,128])
-}</span><span>
</span><a name="line-176"></a><span class="hs-keyword">newtype</span><span> </span><a name="AsMap"><a href="Flat.Instances.Mono.html#AsMap"><span class="hs-identifier">AsMap</span></a></a><span> </span><a name="local-6989586621679085095"><a href="#local-6989586621679085095"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-177"></a><span>  </span><a name="AsMap"><a href="Flat.Instances.Mono.html#AsMap"><span class="hs-identifier">AsMap</span></a></a><span>
</span><a name="line-178"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unMap"><a href="Flat.Instances.Mono.html#unMap"><span class="hs-identifier">unMap</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679085095"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsMap</span><span> </span><a href="#local-6989586621679085099"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ContainerKey</span><span> </span><a href="#local-6989586621679085099"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MapValue</span><span> </span><a href="#local-6989586621679085099"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><a href="Flat.Instances.Mono.html#AsMap"><span class="hs-identifier hs-type">AsMap</span></a><span> </span><a href="#local-6989586621679085099"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>  </span><a name="local-8214565720323842424"><a href="Flat.Class.html#size"><span class="hs-identifier">size</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#sizeMap"><span class="hs-identifier hs-var">sizeMap</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unMap</span><span>
</span><a name="line-183"></a><span>  </span><a name="local-8214565720323842422"><a href="Flat.Class.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#encodeMap"><span class="hs-identifier hs-var">encodeMap</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unMap</span><span>
</span><a name="line-184"></a><span>  </span><a name="local-8214565720323842423"><a href="Flat.Class.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Instances.Mono.html#AsMap"><span class="hs-identifier hs-var">AsMap</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Instances.Mono.html#decodeMap"><span class="hs-identifier hs-var">decodeMap</span></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">sizeMap</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-187"></a><span class="hs-identifier">sizeMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ContainerKey</span><span> </span><a href="#local-6989586621679085107"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MapValue</span><span> </span><a href="#local-6989586621679085107"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IsMap</span><span> </span><a href="#local-6989586621679085107"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Encoder.Types.html#Size"><span class="hs-identifier hs-type">Size</span></a><span> </span><a href="#local-6989586621679085107"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-188"></a><a name="sizeMap"><a href="Flat.Instances.Mono.html#sizeMap"><span class="hs-identifier">sizeMap</span></a></a><span> </span><a name="local-6989586621679085132"><a href="#local-6989586621679085132"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679085133"><a href="#local-6989586621679085133"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">F.foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679085134"><a href="#local-6989586621679085134"><span class="hs-identifier">acc'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679085135"><a href="#local-6989586621679085135"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679085136"><a href="#local-6989586621679085136"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Class.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679085135"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#size"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679085136"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679085134"><span class="hs-identifier hs-var">acc'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679085133"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mapToList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679085132"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-189"></a><span class="hs-comment">-- sizeMap l sz = ofoldl' (\s (k, v) -&gt; size k (size v (s + 1))) (sz + 1) l</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">encodeMap</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- |Encode an instance of IsMap, as a list of (Key,Value) tuples</span><span>
</span><a name="line-193"></a><span class="hs-identifier">encodeMap</span><span>
</span><a name="line-194"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ContainerKey</span><span> </span><a href="#local-6989586621679085106"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MapValue</span><span> </span><a href="#local-6989586621679085106"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IsMap</span><span> </span><a href="#local-6989586621679085106"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679085106"><span class="hs-identifier hs-type">map</span></a><span>
</span><a name="line-196"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Encoder.Strict.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a><span>
</span><a name="line-197"></a><a name="encodeMap"><a href="Flat.Instances.Mono.html#encodeMap"><span class="hs-identifier">encodeMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Flat.Encoder.Strict.html#encodeListWith"><span class="hs-identifier hs-var">encodeListWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679085137"><a href="#local-6989586621679085137"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679085138"><a href="#local-6989586621679085138"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Flat.Class.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679085137"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Flat.Class.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679085138"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mapToList</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">decodeMap</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- |Decode an instance of IsMap, as a list of (Key,Value) tuples</span><span>
</span><a name="line-201"></a><span class="hs-identifier">decodeMap</span><span>
</span><a name="line-202"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ContainerKey</span><span> </span><a href="#local-6989586621679085105"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Flat.Class.html#Flat"><span class="hs-identifier hs-type">Flat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MapValue</span><span> </span><a href="#local-6989586621679085105"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IsMap</span><span> </span><a href="#local-6989586621679085105"><span class="hs-identifier hs-type">map</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Flat.Decoder.Types.html#Get"><span class="hs-identifier hs-type">Get</span></a><span> </span><a href="#local-6989586621679085105"><span class="hs-identifier hs-type">map</span></a><span>
</span><a name="line-203"></a><a name="decodeMap"><a href="Flat.Instances.Mono.html#decodeMap"><span class="hs-identifier">decodeMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapFromList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Decoder.Strict.html#decodeListWith"><span class="hs-identifier hs-var">decodeListWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Flat.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Flat.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a></pre></body></html>